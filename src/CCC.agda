module CCC where

open import Basis
open import Cubical

module CCC where

infixr 1 _â‡’_

open C
  using (Op)
  using (â‰ªFunctorâ‰«)
  using (â‰ªPresheafâ‰«)
  using (â‰ªSetoidâ‰«)
  using (â‰ª_[-,_]â‰«)
  using (â‰ª_âˆ˜-â‰«â‚)

ğŸ˜ : âˆ€ {I} â†’ Presheaf I
ğŸ˜ {I} .apâ‚€ x = S.ğŸ˜
ğŸ˜ {I} .apâ‚ f = S.idn
ğŸ˜ {I} .apâ‚‚ Î± {()}
ğŸ˜ {I} .coh-idn {x} {()}
ğŸ˜ {I} .coh-cmp g f {()}

Â¡ : âˆ€ {I} {ğ’³ : Presheaf I} â†’ â‰ªPresheafâ‰« I âŠ§ ğŸ˜ â‡¾ ğ’³
Â¡ {ğ’³ = ğ’³} .apâ‚€ x = S.Â¡
Â¡ {ğ’³ = ğ’³} .apâ‚ f {()}

ğŸ™ : âˆ€ {I} â†’ Presheaf I
ğŸ™ {I} .apâ‚€ x = S.ğŸ™
ğŸ™ {I} .apâ‚ f = S.idn
ğŸ™ {I} .apâ‚‚ Î± = *
ğŸ™ {I} .coh-idn = *
ğŸ™ {I} .coh-cmp g f = *

! : âˆ€ {I} {ğ’³ : Presheaf I} â†’ â‰ªPresheafâ‰« I âŠ§ ğ’³ â‡¾ ğŸ™
! {ğ’³ = ğ’³} .apâ‚€ x = S.!
! {ğ’³ = ğ’³} .apâ‚ f = *

_âŠ—_ : âˆ€ {I} (ğ’³ ğ’´ : Presheaf I) â†’ Presheaf I
(ğ’³ âŠ— ğ’´) .apâ‚€ x = apâ‚€ ğ’³ x S.âŠ— apâ‚€ ğ’´ x
(ğ’³ âŠ— ğ’´) .apâ‚ f = S.âŸ¨ apâ‚ ğ’³ f âŠ— apâ‚ ğ’´ f âŸ©
(ğ’³ âŠ— ğ’´) .apâ‚‚ Î± = apâ‚‚ ğ’³ Î± , apâ‚‚ ğ’´ Î±
(ğ’³ âŠ— ğ’´) .coh-idn = coh-idn ğ’³ , coh-idn ğ’´
(ğ’³ âŠ— ğ’´) .coh-cmp g f = coh-cmp ğ’³ g f , coh-cmp ğ’´ g f

fst : âˆ€ {I} {ğ’³ ğ’´ : Presheaf I} â†’ â‰ªPresheafâ‰« I âŠ§ ğ’³ âŠ— ğ’´ â‡¾ ğ’³
fst {I}{ğ’³}{ğ’´} .apâ‚€ x = S.fst
fst {I}{ğ’³}{ğ’´} .apâ‚ f = idnâ‚€ (apâ‚€ ğ’³ _)

snd : âˆ€ {I} {ğ’³ ğ’´ : Presheaf I} â†’ â‰ªPresheafâ‰« I âŠ§ ğ’³ âŠ— ğ’´ â‡¾ ğ’´
snd {I}{ğ’³}{ğ’´} .apâ‚€ x = S.snd
snd {I}{ğ’³}{ğ’´} .apâ‚ f = idnâ‚€ (apâ‚€ ğ’´ _)

âŸ¨_,_âŸ©
  : âˆ€ {I} {ğ’³ ğ’´ ğ’µ : Presheaf I}
  â†’ (Î± : â‰ªPresheafâ‰« I âŠ§ ğ’µ â‡¾ ğ’³)
  â†’ (Î² : â‰ªPresheafâ‰« I âŠ§ ğ’µ â‡¾ ğ’´)
  â†’ â‰ªPresheafâ‰« I âŠ§ ğ’µ â‡¾ ğ’³ âŠ— ğ’´
âŸ¨ Î± , Î² âŸ© .apâ‚€ x = S.âŸ¨ apâ‚€ Î± x , apâ‚€ Î² x âŸ©
âŸ¨ Î± , Î² âŸ© .apâ‚ f = apâ‚ Î± f , apâ‚ Î² f

_â‡’â‚€_
  : âˆ€ {I} (ğ’³ ğ’´ : Presheaf I)
  â†’ âŸª I âŸ« .â—
  â†’ Setoid
_â‡’â‚€_ {I} ğ’³ ğ’´ x = â‰ªhomâ‰« (â‰ªPresheafâ‰« I) (â‰ª I [-, x ]â‰« âŠ— ğ’³) ğ’´

_â‡’â‚â‚€â‚€_
  : âˆ€ {I} (ğ’³ ğ’´ : Presheaf I) {y a x}
  â†’ I âŠ§ a â‡¾ y
  â†’ â‰ªPresheafâ‰« I âŠ§ â‰ª I [-, y ]â‰« âŠ— ğ’³ â‡¾ ğ’´
  â†’ â‰ªSetoidâ‰« âŠ§ â‰ªhomâ‰« I x a S.âŠ— apâ‚€ ğ’³ x â‡¾ apâ‚€ ğ’´ x
_â‡’â‚â‚€â‚€_ ğ’³ ğ’´ {y}{a}{x} g Î± =
  S.cmp (apâ‚€ Î± x) S.âŸ¨ apâ‚€ C.â‰ª g âˆ˜-â‰«â‚ x âŠ— S.idn âŸ©

_â‡’â‚â‚€_
  : âˆ€ {I} (ğ’³ ğ’´ : Presheaf I) {y a}
  â†’ I âŠ§ a â‡¾ y
  â†’ â‰ªPresheafâ‰« I âŠ§ â‰ª I [-, y ]â‰« âŠ— ğ’³ â‡¾ ğ’´
  â†’ â‰ªPresheafâ‰« I âŠ§ â‰ª I [-, a ]â‰« âŠ— ğ’³ â‡¾ ğ’´
_â‡’â‚â‚€_ {I} ğ’³ ğ’´ g Î± .apâ‚€ x = (ğ’³ â‡’â‚â‚€â‚€ ğ’´) g Î±
_â‡’â‚â‚€_ {I} ğ’³ ğ’´ g Î± .apâ‚ {a}{x} k =
  cmpâ‚€ (apâ‚€ ğ’´ x)
    (apâ‚ Î± k)
    (apâ‚ (apâ‚€ Î± x) (invâ‚ I (coh-Î± I) , idnâ‚€ (apâ‚€ ğ’³ x)))

_â‡’â‚â‚_
  : âˆ€ {I} (ğ’³ ğ’´ : Presheaf I) {y a} {g : âŸª I âŸ« .âˆ‚ a y .â—}
  â†’ (Î± Î² : â‰ªPresheafâ‰« I âŠ§ â‰ª I [-, y ]â‰« âŠ— ğ’³ â‡¾ ğ’´)
  â†’ hom ((ğ’³ â‡’â‚€ ğ’´) y) Î± Î²
  â†’ hom ((ğ’³ â‡’â‚€ ğ’´) a) ((ğ’³ â‡’â‚â‚€ ğ’´) g Î±) ((ğ’³ â‡’â‚â‚€ ğ’´) g Î²)
_â‡’â‚â‚_ ğ’³ ğ’´ Î± Î² p = p

_â‡’â‚_
  : âˆ€ {I} (ğ’³ ğ’´ : Presheaf I) {x y}
  â†’ I âŠ§ y â‡¾ x
  â†’ â‰ªSetoidâ‰« âŠ§ (ğ’³ â‡’â‚€ ğ’´) x â‡¾ (ğ’³ â‡’â‚€ ğ’´) y
_â‡’â‚_ ğ’³ ğ’´ f .apâ‚€ = (ğ’³ â‡’â‚â‚€ ğ’´) f
_â‡’â‚_ ğ’³ ğ’´ f .apâ‚ {Î±}{Î²} = (ğ’³ â‡’â‚â‚ ğ’´) Î± Î²

_â‡’â‚‚_
  : âˆ€ {I} (ğ’³ ğ’´ : Presheaf I)
  â†’ âˆ€ {y a}{gâ‚€ gâ‚ : Op I âŠ§ y â‡¾ a}
  â†’ Op I âŠ§ gâ‚€ â‡” gâ‚
  â†’ â‰ªSetoidâ‰« âŠ§ (ğ’³ â‡’â‚ ğ’´) gâ‚€ â‡” (ğ’³ â‡’â‚ ğ’´) gâ‚
_â‡’â‚‚_ {I} ğ’³ ğ’´ {y}{a}{gâ‚€}{gâ‚} p {Î±}{x}{f , s} =
  apâ‚ (apâ‚€ Î± x) (coh-Ï‰-Î» I p , idnâ‚€ (apâ‚€ ğ’³ x))

_â‡’_ : âˆ€ {I} (ğ’³ ğ’´ : Presheaf I) â†’ Presheaf I
_â‡’_ {I} ğ’³ ğ’´ .apâ‚€ = ğ’³ â‡’â‚€ ğ’´
_â‡’_ {I} ğ’³ ğ’´ .apâ‚ = ğ’³ â‡’â‚ ğ’´
_â‡’_ {I} ğ’³ ğ’´ .apâ‚‚ = ğ’³ â‡’â‚‚ ğ’´
_â‡’_ {I} ğ’³ ğ’´ .coh-idn {y}{Î±}{x}{f , s} =
  apâ‚ (apâ‚€ Î± x) (coh-Î» I , idnâ‚€ (apâ‚€ ğ’³ x))
_â‡’_ {I} ğ’³ ğ’´ .coh-cmp {y}{b}{a} g h {Î±}{x}{f , s} =
  apâ‚ (apâ‚€ Î± x) (coh-Î± I , idnâ‚€ (apâ‚€ ğ’³ x))

-- FIXME: clean this up
Æ›
  : âˆ€ {I} {Î“ ğ’³ ğ’´ : Presheaf I}
  â†’ â‰ªPresheafâ‰« I âŠ§ Î“ âŠ— ğ’³ â‡¾ ğ’´
  â†’ â‰ªPresheafâ‰« I âŠ§ Î“ â‡¾ ğ’³ â‡’ ğ’´
Æ› {I}{Î“} Î± .apâ‚€ j .apâ‚€ Î³ .apâ‚€ i .apâ‚€ (f , x) =
  apâ‚€ (apâ‚€ Î± i) (apâ‚€ (apâ‚ Î“ f) Î³ , x)
Æ› {I}{Î“} Î± .apâ‚€ j .apâ‚€ Î³ .apâ‚€ i .apâ‚ {fâ‚€ , xâ‚€}{fâ‚ , xâ‚} (Î² , p) =
  apâ‚ (apâ‚€ Î± i) (apâ‚‚ Î“ Î² {Î³} , p)
Æ› {I}{Î“}{ğ’³}{ğ’´} Î± .apâ‚€ j .apâ‚€ Î³ .apâ‚ {k}{i} f {g , x} =
  cmpâ‚€ (apâ‚€ ğ’´ i)
    (apâ‚ Î± f)
    (apâ‚ (apâ‚€ Î± i) (coh-cmp Î“ f g , idnâ‚€ (apâ‚€ ğ’³ i)))
Æ› {I}{Î“}{ğ’³}{ğ’´} Î± .apâ‚€ i .apâ‚ {Î³â‚€}{Î³â‚} f {j}{g , x} =
  apâ‚ (apâ‚€ Î± j) (apâ‚ (apâ‚ Î“ g) f , idnâ‚€ (apâ‚€ ğ’³ j))
Æ› {I}{Î“}{ğ’³}{ğ’´} Î± .apâ‚ {j}{k} f {Î³}{i}{g , x} =
  apâ‚ (apâ‚€ Î± i)
    ( invâ‚€ (apâ‚€ Î“ i) (coh-cmp Î“ g f)
    , idnâ‚€ (apâ‚€ ğ’³ i)
    )
